<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>Selectable ranges on month layer</title>
        <link href="css/calendar.css" rel="stylesheet">
        <link href="css/timepicker.css" rel="stylesheet">
    </head>

    <body>
        <div class="code-html">
            <!-- Shared calendar layer for datepicker element -->
            <div id="layer" class="layer" style="display:none;"></div>

            <label>Start:</label>

            <!-- Drawing datepicker for start date -->
            <input id="datepicker-start" type="text" />

            <label>End:</label>

            <!-- Drawing datepicker for end date -->
            <input id="datepicker-end" type="text" />
        </div>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.rawgit.com/nhnent/tui.code-snippet/1.2.1/code-snippet.js"></script>
        <script type="text/javascript" src="https://cdn.rawgit.com/nhnent/tui.component.calendar/1.2.0/dist/calendar.js"></script>
        <script type="text/javascript" src="../dist/tui-component-date-picker.js"></script>
        <script class="code-js">

            function getTodayHash() {
                var today = new Date();

                return {
                    year: today.getFullYear(),
                    month: today.getMonth() + 1
                };
            }

            function getRelativeDateHash(dateObj, month) {
                var relativeDate = new Date(dateObj.year, dateObj.month - 1 + month, 1);

                return {
                    year: relativeDate.getFullYear(),
                    month: relativeDate.getMonth() + 1
                };
            }

            function getUnlimitedDateHash() {
                return {
                    year: 2099,
                    month: 12
                };
            }

            // Step 1: Init date for setting datepicker
            var startDate1 = getTodayHash();
            var endDate1 = getUnlimitedDateHash();
            var startDate2 = getRelativeDateHash(startDate1, 2);
            var endDate2 = getUnlimitedDateHash();

            // Step 2: Create each component
            var calendar = new tui.component.Calendar({
                element: '#layer'
            });

            var startDatepicker = new tui.component.DatePicker({
                element: '#datepicker-start',
                dateForm: 'yyyy년 mm월',
                selectableRanges: [
                    [startDate1, endDate1]
                ]
            }, calendar);

            var endDatepicker = new tui.component.DatePicker({
                element: '#datepicker-end',
                dateFormat: 'yyyy년 mm월',
                date: startDate2,
                selectableRanges: [
                    [startDate2, endDate2]
                ]
            }, calendar);

            // Step 3: Pick start date
            startDatepicker.on('pick', function() {
                var pickedDate = startDatepicker.getDateHash();
                var newStartDate = getRelativeDateHash(pickedDate, 2); // after 2 months
                var newEndDate = getUnlimitedDateHash();

                // Step 3-1: Change ranges each datepicker
                startDatepicker.setRanges([[pickedDate, newEndDate]]);
                endDatepicker.setRanges([[pickedDate, newEndDate]]);

                // Step 3-2: Change picked end date
                endDatepicker.setDate(newStartDate.year, newStartDate.month);
            });

            // Step 4: Pick end date
            endDatepicker.on('pick', function() {
                var pickedDate = endDatepicker.getDateHash();
                var newStartDate = getRelativeDateHash(pickedDate, -2); // before 2 months
                var newEndDate = getUnlimitedDateHash();

                // Step 4-1: Change ranges each datepicker
                endDatepicker.setRanges([[newStartDate, newEndDate]]);
                startDatepicker.setRanges([[newStartDate, newEndDate]]);

                // Step 4-2: Change picked start date
                startDatepicker.setDate(newStartDate.year, newStartDate.month);
            });

        </script>
    </body>
</html>
