<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>Selectable ranges on date layer</title>
        <link type="text/css" rel="stylesheet" href="../styles/prettify-jsdoc.css" />
        <link type="text/css" rel="stylesheet" href="../styles/prettify-tomorrow.css">
        <link type="text/css" rel="stylesheet" href="../styles/tui.css">
        <link href="css/calendar.css" rel="stylesheet">
        <link href="css/timepicker.css" rel="stylesheet">
    </head>

    <body>
        <div class="wrap" style="height:300px;">

            <!-- Shared calendar layer for datepicker element -->
            <div id="layer" class="layer" style="display:none;"></div>

            <label>Start:</label>

            <!-- Drawing datepicker for start date -->
            <input id="datepicker-start" type="text" />

            <label>End:</label>

            <!-- Drawing datepicker for end date -->
            <input id="datepicker-end" type="text" />

        </div>

        <div class="codeArea"></div>

        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/code-snippet.js"></script>
        <script type="text/javascript" src="js/calendar.js"></script>
        <script type="text/javascript" src="js/date-picker.js"></script>

        <script src="../scripts/prettify/prettify.js"></script>
        <script src="../scripts/prettify/lang-css.js"></script>
        <script src="../scripts/samplecode.js"></script>
        <script class="serviceCode">

            function getTodayHash() {
                var today = new Date();

                return {
                    year: today.getFullYear(),
                    month: today.getMonth() + 1,
                    date: today.getDate()
                };
            }

            function getRelativeDateHash(dateObj, date) {
                var relativeDate = new Date(dateObj.year, dateObj.month - 1, dateObj.date + date);

                return {
                    year: relativeDate.getFullYear(),
                    month: relativeDate.getMonth() + 1,
                    date: relativeDate.getDate()
                };
            }

            function getUnlimitedDateHash() {
                return {
                    year: 2099,
                    month: 12,
                    date: 31
                };
            }

            // Step 1: Init date for setting datepicker
            var startDate1 = getTodayHash();
            var endDate1 = getUnlimitedDateHash();
            var startDate2 = getRelativeDateHash(startDate1, 7);
            var endDate2 = getUnlimitedDateHash();

            // Step 2: Create each component
            var calendar = new tui.component.Calendar({
                element: '#layer'
            });

            var startDatepicker = new tui.component.DatePicker({
                element: '#datepicker-start',
                dateForm: 'yyyy년 mm월 dd일',
                selectableRanges: [
                    [startDate1, endDate1]
                ]
            }, calendar);

            var endDatepicker = new tui.component.DatePicker({
                element: '#datepicker-end',
                dateFormat: 'yyyy년 mm월 dd일',
                date: startDate2,
                selectableRanges: [
                    [startDate2, endDate2]
                ]
            }, calendar);

            // Step 3: Pick start date
            startDatepicker.on('pick', function() {
                var pickedDate = startDatepicker.getDateHash();
                var newStartDate = getRelativeDateHash(pickedDate, 7); // after 7 days
                var newEndDate = getUnlimitedDateHash();

                // Step 3-1: Change ranges each datepicker
                startDatepicker.setRanges([[pickedDate, newEndDate]]);
                endDatepicker.setRanges([[pickedDate, newEndDate]]);

                // Step 3-2: Change picked end date
                endDatepicker.setDate(newStartDate.year, newStartDate.month, newStartDate.date);
            });

            // Step 4: Pick end date
            endDatepicker.on('pick', function() {
                var pickedDate = endDatepicker.getDateHash();
                var newStartDate = getRelativeDateHash(pickedDate, -7); // before 7 days
                var newEndDate = getUnlimitedDateHash();

                // Step 4-1: Change ranges each datepicker
                endDatepicker.setRanges([[newStartDate, newEndDate]]);
                startDatepicker.setRanges([[newStartDate, newEndDate]]);

                // Step 4-2: Change picked start date
                startDatepicker.setDate(newStartDate.year, newStartDate.month, newStartDate.date );
            });

        </script>
    </body>
</html>
